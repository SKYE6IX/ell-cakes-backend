// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                              String           @id @default(uuid()) @postgresql.Uuid
  name                            String           @default("")
  email                           String           @unique @default("")
  password                        String
  phoneNumber                     String           @unique @default("")
  isUserVerified                  Boolean          @default(false)
  userVerificationToken           String?
  userVerificationTokenIssuedAt   DateTime?
  userVerificationTokenRedeemedAt DateTime?
  role                            String           @default("CUSTOMER")
  passwordResetToken              String?
  passwordResetIssuedAt           DateTime?
  passwordResetRedeemedAt         DateTime?
  firstOrderDiscountEligible      Boolean          @default(true)
  delivaryAddress                 DelivaryAddress? @relation("DelivaryAddress_user")
  cart                            Cart?            @relation("Cart_user")
  orders                          Order[]          @relation("Order_user")
  orderBeneficiaries              OrderReceiver[]  @relation("OrderReceiver_benefactor")
  payments                        Payment[]        @relation("Payment_user")
  lastLogin                       DateTime?
  createdAt                       DateTime?        @default(now())
  updatedAt                       DateTime?
  from_OrderIntent_user           OrderIntent[]    @relation("OrderIntent_user")
}

model DelivaryAddress {
  id                               String        @id @default(uuid()) @postgresql.Uuid
  user                             User?         @relation("DelivaryAddress_user", fields: [userId], references: [id])
  userId                           String?       @unique @map("user") @postgresql.Uuid
  orders                           Order[]       @relation("Order_deliveryAddress")
  address                          String        @default("")
  apartmentNumber                  String        @default("")
  floor                            String        @default("")
  intercomCode                     String        @default("")
  createdAt                        DateTime?     @default(now())
  updatedAt                        DateTime?
  from_OrderIntent_deliveryAddress OrderIntent[] @relation("OrderIntent_deliveryAddress")
}

model Product {
  id                              String                @id @default(uuid()) @postgresql.Uuid
  categories                      Category[]            @relation("Category_products")
  name                            String                @default("")
  slug                            String                @unique @default("")
  baseDescription                 String                @default("")
  type                            String
  variantType                     String
  fillings                        ProductFilling[]      @relation("Product_fillings")
  mixBoxProduct                   MixBoxProduct?        @relation("MixBoxProduct_product")
  isAvailable                     Boolean               @default(true)
  badge                           String?
  images                          ProductImage[]        @relation("ProductImage_product")
  video                           ProductVideo?         @relation("Product_video", fields: [videoId], references: [id])
  videoId                         String?               @unique @map("video") @postgresql.Uuid
  customizations                  CustomizationOption[] @relation("CustomizationOption_product")
  topping                         Topping?              @relation("Product_topping", fields: [toppingId], references: [id])
  toppingId                       String?               @map("topping") @postgresql.Uuid
  createdAt                       DateTime?             @default(now())
  updatedAt                       DateTime?
  from_CartItem_product           CartItem[]            @relation("CartItem_product")
  from_OrderItem_product          OrderItem[]           @relation("OrderItem_product")
  from_ProductHomeBanner_product  ProductHomeBanner[]   @relation("ProductHomeBanner_product")
  from_FeaturedProduct_products   FeaturedProduct[]     @relation("FeaturedProduct_products")
  from_MixBoxProduct_compositions MixBoxProduct[]       @relation("MixBoxProduct_compositions")

  @@index([toppingId])
}

model ProductFilling {
  id                   String           @id @default(uuid()) @postgresql.Uuid
  products             Product[]        @relation("Product_fillings")
  name                 String           @default("")
  slug                 String           @unique @default("")
  hasDetails           Boolean          @default(true)
  description          String           @default("")
  carbonhydrate        Decimal?         @postgresql.Decimal(5, 2)
  calories             Decimal?         @postgresql.Decimal(5, 2)
  protein              Decimal?         @postgresql.Decimal(5, 2)
  fat                  Decimal?         @postgresql.Decimal(5, 2)
  ingredients          String           @default("")
  image_icon_id        String?
  image_icon_filesize  Int?
  image_icon_width     Int?
  image_icon_height    Int?
  image_icon_extension String?
  variants             ProductVariant[] @relation("ProductVariant_filling")
  createdAt            DateTime?        @default(now())
  updatedAt            DateTime?
}

model ProductImage {
  id              String    @id @default(uuid()) @postgresql.Uuid
  product         Product?  @relation("ProductImage_product", fields: [productId], references: [id])
  productId       String?   @map("product") @postgresql.Uuid
  image_id        String?
  image_filesize  Int?
  image_width     Int?
  image_height    Int?
  image_extension String?
  altText         String    @default("")
  isMain          Boolean   @default(false)
  createdAt       DateTime? @default(now())
  updatedAt       DateTime?

  @@index([productId])
}

model ProductVariant {
  id                     String          @id @default(uuid()) @postgresql.Uuid
  filling                ProductFilling? @relation("ProductVariant_filling", fields: [fillingId], references: [id])
  fillingId              String?         @map("filling") @postgresql.Uuid
  weight                 Decimal?        @postgresql.Decimal(4, 1)
  pieces                 Int?
  size                   Int?
  price                  Int
  serving                Int?
  createdAt              DateTime?       @default(now())
  updatedAt              DateTime?
  from_CartItem_variant  CartItem[]      @relation("CartItem_variant")
  from_OrderItem_variant OrderItem[]     @relation("OrderItem_variant")

  @@index([fillingId])
}

model Category {
  id                   String     @id @default(uuid()) @postgresql.Uuid
  name                 String     @default("")
  slug                 String     @unique @default("")
  parent               Category?  @relation("Category_parent", fields: [parentId], references: [id])
  parentId             String?    @map("parent") @postgresql.Uuid
  isAvailable          Boolean    @default(true)
  products             Product[]  @relation("Category_products")
  createdAt            DateTime?  @default(now())
  updatedAt            DateTime?
  from_Category_parent Category[] @relation("Category_parent")

  @@index([parentId])
}

model CustomizationOption {
  id           String                     @id @default(uuid()) @postgresql.Uuid
  product      Product[]                  @relation("CustomizationOption_product")
  name         String?
  slug         String                     @unique @default("")
  customValues CustomizationOptionValue[] @relation("CustomizationOptionValue_option")
  createdAt    DateTime?                  @default(now())
  updatedAt    DateTime?
}

model CustomizationOptionValue {
  id         String               @id @default(uuid()) @postgresql.Uuid
  option     CustomizationOption? @relation("CustomizationOptionValue_option", fields: [optionId], references: [id])
  optionId   String?              @map("option") @postgresql.Uuid
  value      String               @default("")
  extraPrice Int?
  createdAt  DateTime?            @default(now())
  updatedAt  DateTime?

  @@index([optionId])
}

model Topping {
  id        String          @id @default(uuid()) @postgresql.Uuid
  products  Product[]       @relation("Product_topping")
  name      String          @unique @default("")
  slug      String          @unique @default("")
  options   ToppingOption[] @relation("ToppingOption_topping")
  createdAt DateTime?       @default(now())
  updatedAt DateTime?
}

model ToppingOption {
  id                           String      @id @default(uuid()) @postgresql.Uuid
  topping                      Topping?    @relation("ToppingOption_topping", fields: [toppingId], references: [id])
  toppingId                    String?     @map("topping") @postgresql.Uuid
  weight                       Decimal?    @postgresql.Decimal(5, 3)
  pieces                       Int?
  extraPrice                   Int
  createdAt                    DateTime?   @default(now())
  updatedAt                    DateTime?
  from_CartItem_toppingOption  CartItem[]  @relation("CartItem_toppingOption")
  from_OrderItem_toppingOption OrderItem[] @relation("OrderItem_toppingOption")

  @@index([toppingId])
}

model Cart {
  id                    String        @id @default(uuid()) @postgresql.Uuid
  sessionId             String?       @unique
  user                  User?         @relation("Cart_user", fields: [userId], references: [id])
  userId                String?       @unique @map("user") @postgresql.Uuid
  cartItems             CartItem[]    @relation("CartItem_cart")
  subTotal              Int?
  createdAt             DateTime?     @default(now())
  updatedAt             DateTime?
  from_OrderIntent_cart OrderIntent[] @relation("OrderIntent_cart")
}

model CartItem {
  id              String          @id @default(uuid()) @postgresql.Uuid
  cart            Cart?           @relation("CartItem_cart", fields: [cartId], references: [id])
  cartId          String?         @map("cart") @postgresql.Uuid
  product         Product?        @relation("CartItem_product", fields: [productId], references: [id])
  productId       String?         @map("product") @postgresql.Uuid
  variant         ProductVariant? @relation("CartItem_variant", fields: [variantId], references: [id])
  variantId       String?         @map("variant") @postgresql.Uuid
  toppingOption   ToppingOption?  @relation("CartItem_toppingOption", fields: [toppingOptionId], references: [id])
  toppingOptionId String?         @map("toppingOption") @postgresql.Uuid
  compositions    Json?
  customizations  Json?
  quantity        Int?            @default(1)
  unitPrice       Int?
  subTotal        Int?
  createdAt       DateTime?       @default(now())
  updatedAt       DateTime?

  @@index([cartId])
  @@index([productId])
  @@index([variantId])
  @@index([toppingOptionId])
}

model Order {
  id                String           @id @default(uuid()) @postgresql.Uuid
  orderIntent       OrderIntent?     @relation("Order_orderIntent", fields: [orderIntentId], references: [id])
  orderIntentId     String?          @unique @map("orderIntent") @postgresql.Uuid
  user              User?            @relation("Order_user", fields: [userId], references: [id])
  userId            String?          @map("user") @postgresql.Uuid
  orderReceiver     OrderReceiver?   @relation("Order_orderReceiver", fields: [orderReceiverId], references: [id])
  orderReceiverId   String?          @unique @map("orderReceiver") @postgresql.Uuid
  orderItems        OrderItem[]      @relation("OrderItem_order")
  orderNumber       String           @unique @default("")
  shippingCost      Int?
  subTotalAmount    Int?
  totalAmount       Int?
  status            String?          @default("PROCESSING")
  payment           Payment?         @relation("Order_payment", fields: [paymentId], references: [id])
  paymentId         String?          @unique @map("payment") @postgresql.Uuid
  deliveryOption    String           @default("")
  deliveryAddress   DelivaryAddress? @relation("Order_deliveryAddress", fields: [deliveryAddressId], references: [id])
  deliveryAddressId String?          @map("deliveryAddress") @postgresql.Uuid
  note              String           @default("")
  createdAt         DateTime?        @default(now())
  updatedAt         DateTime?

  @@index([userId])
  @@index([deliveryAddressId])
}

model OrderReceiver {
  id                             String        @id @default(uuid()) @postgresql.Uuid
  benefactor                     User?         @relation("OrderReceiver_benefactor", fields: [benefactorId], references: [id])
  benefactorId                   String?       @map("benefactor") @postgresql.Uuid
  order                          Order?        @relation("Order_orderReceiver")
  name                           String        @default("")
  phoneNumber                    String        @default("")
  createdAt                      DateTime?     @default(now())
  updatedAt                      DateTime?
  from_OrderIntent_orderReceiver OrderIntent[] @relation("OrderIntent_orderReceiver")

  @@index([benefactorId])
}

model OrderItem {
  id              String          @id @default(uuid()) @postgresql.Uuid
  order           Order?          @relation("OrderItem_order", fields: [orderId], references: [id])
  orderId         String?         @map("order") @postgresql.Uuid
  product         Product?        @relation("OrderItem_product", fields: [productId], references: [id])
  productId       String?         @map("product") @postgresql.Uuid
  variant         ProductVariant? @relation("OrderItem_variant", fields: [variantId], references: [id])
  variantId       String?         @map("variant") @postgresql.Uuid
  toppingOption   ToppingOption?  @relation("OrderItem_toppingOption", fields: [toppingOptionId], references: [id])
  toppingOptionId String?         @map("toppingOption") @postgresql.Uuid
  compositions    Json?
  customizations  Json?
  quantity        Int?
  unitPrice       Int?
  subTotal        Int?
  createdAt       DateTime?       @default(now())
  updatedAt       DateTime?

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
  @@index([toppingOptionId])
}

model Payment {
  id              String    @id @default(uuid()) @postgresql.Uuid
  user            User?     @relation("Payment_user", fields: [userId], references: [id])
  userId          String?   @map("user") @postgresql.Uuid
  order           Order?    @relation("Order_payment")
  yooMoneyId      String    @unique @default("")
  redirectUrl     String    @default("")
  confirmationUrl String    @default("")
  amount          String    @default("")
  method          String    @default("")
  status          String?   @default("PENDING")
  paidAt          DateTime?
  createdAt       DateTime? @default(now())
  updatedAt       DateTime?

  @@index([userId])
}

model ProductHomeBanner {
  id         String    @id @default(uuid()) @postgresql.Uuid
  product    Product?  @relation("ProductHomeBanner_product", fields: [productId], references: [id])
  productId  String?   @map("product") @postgresql.Uuid
  bannerText String    @default("")
  createdAt  DateTime? @default(now())
  updatedAt  DateTime?

  @@index([productId])
}

model CustomizeImage {
  id              String    @id @default(uuid()) @postgresql.Uuid
  image_id        String?
  image_filesize  Int?
  image_width     Int?
  image_height    Int?
  image_extension String?
  altText         String    @default("")
  createdAt       DateTime? @default(now())
  updatedAt       DateTime?
}

model FeaturedProduct {
  id        String    @id @default(uuid()) @postgresql.Uuid
  products  Product[] @relation("FeaturedProduct_products")
  createdAt DateTime? @default(now())
  updatedAt DateTime?
}

model OrderIntent {
  id                String           @id @default(uuid()) @postgresql.Uuid
  intentId          String           @unique @default("")
  yooMoneyId        String           @unique @default("")
  paymentId         String           @default("")
  cart              Cart?            @relation("OrderIntent_cart", fields: [cartId], references: [id])
  cartId            String?          @map("cart") @postgresql.Uuid
  user              User?            @relation("OrderIntent_user", fields: [userId], references: [id])
  userId            String?          @map("user") @postgresql.Uuid
  orderReceiver     OrderReceiver?   @relation("OrderIntent_orderReceiver", fields: [orderReceiverId], references: [id])
  orderReceiverId   String?          @map("orderReceiver") @postgresql.Uuid
  deliveryAddress   DelivaryAddress? @relation("OrderIntent_deliveryAddress", fields: [deliveryAddressId], references: [id])
  deliveryAddressId String?          @map("deliveryAddress") @postgresql.Uuid
  deliveryOption    String           @default("")
  note              String           @default("")
  paymentStatus     String?          @default("PENDING")
  shippingCost      Int?
  totalAmount       Int?
  order             Order?           @relation("Order_orderIntent")
  createdAt         DateTime?        @default(now())
  updatedAt         DateTime?

  @@index([cartId])
  @@index([userId])
  @@index([orderReceiverId])
  @@index([deliveryAddressId])
}

model MixBoxProduct {
  id           String    @id @default(uuid()) @postgresql.Uuid
  product      Product?  @relation("MixBoxProduct_product", fields: [productId], references: [id])
  productId    String?   @unique @map("product") @postgresql.Uuid
  compositions Product[] @relation("MixBoxProduct_compositions")
  createdAt    DateTime? @default(now())
  updatedAt    DateTime?
}

model ProductVideo {
  id             String    @id @default(uuid()) @postgresql.Uuid
  product        Product?  @relation("Product_video")
  video_filesize Int?
  video_filename String?
  createdAt      DateTime? @default(now())
  updatedAt      DateTime?
}
